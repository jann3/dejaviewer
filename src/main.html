<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>DejaViewer</title>
  <link href="https://fonts.googleapis.com/css?family=Blinker|Open+Sans" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/chiller" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="style.css" />
  <script type="text/javascript">

    deja.receive("response", (message) => {
      console.log(`response from main: ${message}`);
    });

    document.addEventListener("drop", function (event) {
      event.preventDefault();
      event.stopPropagation();

      for (let file of event.dataTransfer.files) {
        console.log("sending from drag/drop", file.path);
        window.deja.send("filepath", file.path)
      }
      // drop indicator
      document.getElementById("drag-overlay").style.display = "none";
    });

    document.addEventListener("dragover", function (event) {
      event.preventDefault();
      event.stopPropagation();

      // dragover indicator
      document.getElementById("drag-overlay").style.display = "block";
    });

    document.addEventListener("dragleave", function (event) {
      event.preventDefault();
      event.stopPropagation();

      // dragover indicator
      document.getElementById("drag-overlay").style.display = "none";
    });

    function toggleOverlay(target) {
      let targetOverlay = document.getElementById(target);

      if (targetOverlay.classList.contains("fadeIn")) {
        targetOverlay.classList.toggle("fadeIn");
        targetOverlay.classList.add("fadeOut");
        setTimeout(() => {
          targetOverlay.style.display = 'none';
        }, 300)
      } else {
        targetOverlay.classList.toggle("fadeOut");
        targetOverlay.classList.add("fadeIn");
        targetOverlay.style.display = "block";
      }
    }

    function toggleButton(target) {
      let targetButton = document.getElementById(target);

      if (targetButton.textContent === '?') {
        targetButton.textContent = 'âœ–';
      } else {
        targetButton.textContent = '?';
      }
    }

    function openFile() {
      const dialogConfig = {
        title: 'Select a file',
        buttonLabel: 'Open',
        properties: ['openFile'],
        filters: [
          {
            name: "All Image Files",
            extensions: [
              "jpg",
              "jpeg",
              "png",
              "gif",
              "webp",
              "ico",
              "bmp",
              "jfif",
              "pjpeg",
              "pjp",
              "svg",
              "svgz",
              "tiff",
              "tif",
              "webp",
              "avif",
              "xbm",
            ],
          },
          { name: "JPEG", extensions: ["jpg", "jpeg"] },
          { name: "PNG", extensions: ["png"] },
          { name: "GIF", extensions: ["gif"] },
          { name: "TIFF", extensions: ["tif", "tiff"] },
          { name: "WebP", extensions: ["webp"] },
          { name: "AVIF", extensions: ["avif"] },],
      };
      deja.openDialog("showOpenDialog", dialogConfig);
    }
  </script>
  <meta http-equiv="Content-Security-Policy"
    content="style-src 'self' https://*.googleapis.com https://*.cdnfonts.com" />
</head>

<body>
  <header id="help-button" tabindex="0" onclick="toggleOverlay('help-overlay'); toggleButton('help-button');">?</header>
  <main>
    <aside>
      <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 271.2 271.35">
        <g id="logo"><text class="cls-1" transform="translate(44.09 177.73)">
            <tspan xml:space="preserve"> viewer</tspan>
          </text><text class="cls-2" transform="translate(60.38 129.51)">Deja</text></g>
        <g id="frames">
          <g class="cls-3">
            <polygon class="cls-4"
              points="31.32 32.47 31.32 204.78 53.37 204.78 53.37 54.52 204.78 54.52 204.78 32.47 31.32 32.47" />
            <polygon class="cls-4"
              points="242.89 32.47 242.89 54.52 249.15 54.52 249.15 249.3 53.37 249.3 53.37 242.89 31.32 242.89 31.32 271.35 271.2 271.35 271.2 32.47 242.89 32.47" />
          </g>
          <path class="cls-4" d="M249.23,249.16H14.4V14.32H249.23Zm-212.83-22H227.23V36.32H36.4Z"
            transform="translate(-14.4 -14.32)" />
        </g>
      </svg>
    </aside>
    <ol>
      <li>
        <span>
          <div>Open an image by using the Browse button. Or drag and drop the file into this
            window.</div>
          <div>
            <input type="button" value="Browse" onclick="openFile();" />
          </div>
        </span>
      </li>
      <li>
        Make changes to your image file with an external editor and save it. The viewer will now
        automatically
        reload.
      </li>
    </ol>
    <div id="help-overlay" class="overlay fadeOut">
      <section>
        <h1>Help</h1>
        Press Escape to return to the main page or quit the app.
      </section>
    </div>
    <div id="drag-overlay" class="overlay">
    </div>
  </main>
</body>

</html>